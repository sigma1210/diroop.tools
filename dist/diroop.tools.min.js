!function(e){"use strict";e.module("diroop.tools",["diroop.tools.templateCache","diroop.schema.cache","ui.format"])}(angular),function(e,t){"use strict";function n(t,n,r,o){function a(){return n(function(t,n){function r(e){e?c(e).then(function(e){a.shift(),0===a.length?t(v):r(a[0])})["catch"](function(e){n(e)}):t(v)}v=e.copy(y);var a=e.copy(o.getUris());r(a[0])})}function c(e){return n(function(t,n){if(e){var r=p(e);i(r).then(function(e){t(e)})["catch"](function(e){n({message:"an error occured add parsed path",path:r,error:e})})}else n({message:"no path specified"})})}function i(e){return n(function(t,n){e&&e.protocol?d(e).then(function(r){r.addPath(e.segments).then(function(e){t(e)})["catch"](function(e){n({message:" pn add path error",error:e})})})["catch"](function(e){n({message:"get pn error",error:e})}):n({message:"malformed Parsed Path",parsedPath:e})})}function s(t,r){return n(function(n,o){if(t)if(e.isArray(r)&&r.length>0){var a=r[0];t.nodes[a]?n(t.nodes[a]):u(a,r).then(function(e){t.nodes[a]=e,t.nodes.push(e),n(t.nodes[a])})["catch"](function(e){o(e)})}else o({message:"malformed path segments being added to parent",segments:segements,parent:t});else o({message:"parent node not specified"})})}function u(t,r){var o=function(t){function r(t){return n(function(n,r){e.isArray(t)&&t.length>0?s(o,t).then(function(e){t.shift(),e.addPath(t).then(function(e){n(o)})["catch"](function(e){n(o)})})["catch"](function(e){n(o)}):n(o)})}var o=this;o.name=t,o.nodes=[],o.addPath=r,o.type=l},a=function(e){var t=this;t.type=m,t.$ref=e,t.schema=null,t.addPath=function(){return n.when(t)}};return n(function(e,n){if((t||"").endsWith(".schema.json")||1===r.length)e(new a(t));else{var c=new o(t);r.shift(),c.addPath(r).then(function(){e(c)})["catch"](function(t){e(c)})}})}function h(t){var r=function(t){function r(t){return n(function(n,r){e.isArray(t)&&t.length>0?s(o,t).then(function(e){t.shift(),e.addPath(t).then(function(e){n(o)})["catch"](function(e){n(o)})})["catch"](function(e){n(o)}):n(o)})}var o=this;o.name=t,o.type=f,o.nodes=[],o.addPath=r};return n.when(new r(t.protocol))}function d(e){return n(function(t,n){v.nodes[e.protocol]?t(v.nodes[e.protocol]):h(e).then(function(n){v.nodes[e.protocol]=n,v.nodes.push(n),t(v.nodes[e.protocol])})["catch"](function(e){n({message:"an error occcuer creating new protocol node",error:e})})})}function p(t){if(!t)return null;var n=document.createElement("a");n.href=t;var r=[],o=(n.pathname||"").split("/");return e.forEach(o,function(e){e&&r.push(e)}),{protocol:(n.protocol||"").split(":")[0],pathName:n.pathname,segments:r,path:t}}var f="PROTOCOL_NODE_TYPE",l="FOLDER_NODE_TYPE",m="SCHEMA_NODE_TYPE",g="$TREE_ROOT_NODE",y={name:"$cacheroot",nodes:[],type:g},v=e.copy(y),S={addPath:c,getTree:a};return S}t("drCacheTreeService",["$log","$q","$document","drSchemaCache",n])}(angular,angular.module("diroop.tools").factory),function(e,t){"use strict";function n(e){function t(){return d().info()}function n(e,t){t&&e&&(s(e),d().put(e,t))}function r(e){return d().get(e)}function o(e){d().remove(e),u(e)}function a(){d().removeAll(),m=[]}function c(){m=[],d().destroy()}function i(){return m}function s(e){f.hasKey(e)||m.push(e)}function u(e){m=_.without(m,e)}function h(e){return _.contains(m,e)}function d(){return l||(l=e(p)),l}var p="drSchemaCache",f={info:t,put:n,get:r,remove:o,removeAll:a,destroy:c,hasKey:h,getUris:i},l=null,m=[];return f}t("drSchemaCache",["$cacheFactory",n])}(angular,angular.module("diroop.tools").factory),function(e,t){"use strict";var n=function(){function e(){function e(){return t}var n={getVersion:e};return n}var t="1.0.0.1.x",n=this;n.setVersion=function(e){t=e},n.$get=[e]};t("drToolsSettings",[n])}(angular,angular.module("diroop.tools").provider),function(){String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>n.length)&&(t=n.length),t-=e.length;var r=n.lastIndexOf(e,t);return r!==-1&&r===t})}(),function(e,t){"use strict";function n(t,n,r,o){function a(n,a){a=a||15;var c=[];return t(function(t,i){if(n&&n.length>1){var s=o.getUris(),u=_.first(r("filter")(s,n),a);e.forEach(u,function(e){c.push({label:e,path:e})}),t(c)}else t(c)})}var c={search:a};return c}t("drSchemaListService",["$q","$log","$filter","drSchemaCache",n])}(angular,angular.module("diroop.tools").factory),function(e,t){"use strict";function n(t,n,r,o,a){function c(e){return n(function(t,n){a.getValidator().then(function(r){function o(e){i++,i>y?n({message:"Maximum Schema Quota Exceeed"}):h(e).then(function(n){a.addSchema(e,n);var r=a.getMissingUris();0===r.length?t({schema:a.getSchema(c),tv4:a}):o(r[0])})["catch"](function(e){n(e)})}var a=r.freshApi(),c=e,i=0;o(e)})["catch"](function(e){n({message:f,innerError:e})})})}function i(){return n(function(t,n){a.getValidator().then(function(n){var r=n.freshApi();e.forEach(o.getUris(),function(e){r.addSchema(e,o.get(e))}),t({tv4:r,schema:{}})})["catch"](function(e){n({message:f,innerError:e})})})}function s(e){return n(function(t,n){i(e).then(function(r){r.schema={$ref:e},u(r).then(function(e){t(e)})["catch"](function(t){n({message:p,uri:e,innerError:t})})})["catch"](function(t){n({message:p,uri:e,innerError:t})})})}function u(t){return n(function(n,r){function o(n){if(n.$ref){var a=t.tv4.getSchema(n.$ref);return a?n.isBeingHandled?e.copy(a):(n.isBeingHandled=!0,o(e.copy(a))):void r({message:l,$ref:n.$ref})}for(var c in n){var i=n[c];"object"==typeof i&&(delete n[c],n[c]=o(i))}return n}if(t&&t.schema&&t.tv4){var a=o(e.copy(t.schema));a?n(a):r({message:m})}else r({message:g})})}function h(t,r){return n(function(n,r){var a=o.get(t);e.isDefined(a)&&null!==a?n(e.copy(a)):r({message:d,uri:t})})}var d="The current url does not have a a schema stored in drSchemaCache.",p="An error occured expanded schema for uri.",f="An error occured initializing tv4 during schema load.",l="An error occured resolving a url from tv4",m="An unspecified error resulted in a null schema.",g="The schema set did not meet the expected interfacte.",y=1e4,v={getSchemaSet:c,getExpandedSchema:s};return v}t("drSchemaLoader",["$http","$q","$log","drSchemaCache","drTv4Service",n])}(angular,angular.module("diroop.tools").factory),function(e,t,n){"use strict";function r(e,t){function r(){return e(function(e,t){n?e(n):t({message:o})})}var o="TV4 was not loaded. Insure tv4 is referenced.refer to https://github.com/geraintluff/tv4",a={getValidator:r};return a}t("drTv4Service",["$q","$log",r])}(angular,angular.module("diroop.tools").factory,tv4),function(e,t){"use strict";function n(e,t,n){function r(t,r){return e(function(e,c){n.getSchemaSet(t).then(function(n){var a=n.tv4.validateMultiple(r,n.schema);a&&a.valid?e({valid:!0}):c({valid:!1,message:o,errors:a.errors?a.errors:[],missing:a.missing?a.missing:[],schema:t,model:r})})["catch"](function(e){c({message:a})})})}var o="The model did not validate aginst the schema specified",a="An error occured while the schema was being set up for validation",c={validate:r};return c}t("drValidationService",["$q","$log","drSchemaLoader",n])}(angular,angular.module("diroop.tools").factory),function(e,t){"use strict";t("drToolVersion",{templateUrl:"drTemplateCache:/version/version.html",controller:["$log","$filter","drToolsSettings","drCacheTreeService",function(e,t,n,r){var o="diroop.tools : v:version",a=this;a.version=t("format")(o,{version:n.getVersion()})}]})}(angular,angular.module("diroop.tools").component),function(e){try{app=e.module("diroop.schema.cache")}catch(t){app=e.module("diroop.schema.cache",["diroop.tools"])}app.run(["drSchemaCache",function(e){e.put("schemaCache:/address/address.schema.json",{$schema:"http://json-schema.org/draft-04/schema#",description:"An Address following the convention of http://microformats.org/wiki/hcard",type:"object",properties:{"post-office-box":{type:"string"},"extended-address":{type:"string"},"street-address":{type:"string"},locality:{type:"string"},region:{type:"string"},"postal-code":{type:"string"},"country-name":{type:"string"}},required:["locality","region","country-name"],dependencies:{"post-office-box":["street-address"],"extended-address":["street-address"]}})}])}(angular),function(e){try{app=e.module("diroop.schema.cache")}catch(t){app=e.module("diroop.schema.cache",["diroop.tools"])}app.run(["drSchemaCache",function(e){e.put("schemaCache:/geo/geo.schema.json",{$schema:"http://json-schema.org/draft-04/schema#",description:"A geographical coordinate",type:"object",properties:{latitude:{type:"number"},longitude:{type:"number"}}})}])}(angular),function(e){try{app=e.module("diroop.schema.cache")}catch(t){app=e.module("diroop.schema.cache",["diroop.tools"])}app.run(["drSchemaCache",function(e){e.put("schemaCache:/person/bad.schema.json",{$ref:"schemaCache:/noWhereToBeFoundOnPurpose.schema.json"})}])}(angular),function(e){try{app=e.module("diroop.schema.cache")}catch(t){app=e.module("diroop.schema.cache",["diroop.tools"])}app.run(["drSchemaCache",function(e){e.put("schemaCache:/person/hcard.schema.json",{$schema:"http://json-schema.org/draft-04/schema#",description:"A representation of a person, company, organization, or place",type:"object",required:["familyName","givenName"],properties:{fn:{description:"Formatted Name",type:"string"},familyName:{type:"string"},givenName:{type:"string"},additionalName:{type:"array",items:{type:"string"}},honorificPrefix:{type:"array",items:{type:"string"}},honorificSuffix:{type:"array",items:{type:"string"}},nickname:{type:"string"},url:{type:"string",format:"uri"},email:{type:"object",properties:{type:{type:"string"},value:{type:"string",format:"email"}}},tel:{type:"object",properties:{type:{type:"string"},value:{type:"string",format:"phone"}}},adr:{$ref:"schemaCache:/address/address.schema.json"},geo:{$ref:"schemaCache:/geo/geo.schema.json"},tz:{type:"string"},photo:{type:"string"},logo:{type:"string"},sound:{type:"string"},bday:{type:"string",format:"date"},title:{type:"string"},role:{type:"string"},org:{type:"object",properties:{organizationName:{type:"string"},organizationUnit:{type:"string"}}}}})}])}(angular),function(e){try{app=e.module("diroop.schema.cache")}catch(t){app=e.module("diroop.schema.cache",["diroop.tools"])}app.run(["drSchemaCache",function(e){e.put("schemaCache:/really/really/really/deep/test.schema.json",{$schema:"http://json-schema.org/draft-04/schema#",description:"A geographical coordinate",type:"object",properties:{latitude:{type:"number"},longitude:{type:"number"}}})}])}(angular),function(e){try{e=angular.module("diroop.tools.templateCache")}catch(t){e=angular.module("diroop.tools.templateCache",[])}e.run(["$templateCache",function(e){e.put("drTemplateCache:/version/version.html",'<div class="dr-version"><small>{{$ctrl.version}}</small></div>')}])}();
//# sourceMappingURL=diroop.tools.min.js.map
